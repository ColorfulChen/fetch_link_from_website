var P=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var G=(f,y)=>{var _={};for(var r in f)ve.call(f,r)&&y.indexOf(r)<0&&(_[r]=f[r]);if(f!=null&&P)for(var r of P(f))y.indexOf(r)<0&&ge.call(f,r)&&(_[r]=f[r]);return _};var C=(f,y,_)=>new Promise((r,p)=>{var x=o=>{try{h(_.next(o))}catch(R){p(R)}},L=o=>{try{h(_.throw(o))}catch(R){p(R)}},h=o=>o.done?r(o.value):Promise.resolve(o.value).then(x,L);h((_=_.apply(f,y)).next())});import{v as be,r as v,h as H,i as ye,c as U,o as V,J as t,S as l,b as d,G as n,T as i,p as D,ax as xe,I as ke,aa as we,V as J,R as g,H as F,ay as b,az as Ve,M as he,N as Ce,aA as Ue,_ as Le}from"./index-nYLlGrVN.js";import{g as Re,u as Q,c as Be,d as Se,b as ze}from"./websites-Bb-DWnHy.js";import{f as Me}from"./time-DxhBYzk3.js";const Te={class:"website-manage"},We={class:"flex flex-wrap items-center gap-4"},De={class:"flex items-center gap-2"},Fe={class:"flex items-center gap-2"},qe={class:"mt-4 flex justify-end"},Ee={class:"mb-4"},$e={key:0,class:"mt-4"},je={key:0,class:"mt-4"},Ie={class:"list-disc list-inside"},Ne={key:0,class:"text-gray-500"},Ae=be({name:"WebsiteManage",__name:"index",setup(f){const y=v(!1),_=v([]),r=v(0),p=H({status:"",page:1,page_size:20}),x=v(!1),L=v("添加网站"),h=v(),o=H({name:"",url:"",crawl_depth:3,max_links:1e3}),R={name:[{required:!0,message:"请输入网站名称",trigger:"blur"}],url:[{required:!0,message:"请输入网站URL",trigger:"blur"},{type:"url",message:"请输入有效的URL",trigger:"blur"}],crawl_depth:[{required:!0,message:"请输入爬取深度",trigger:"blur"}],max_links:[{required:!0,message:"请输入最大链接数",trigger:"blur"}]},k=()=>C(null,null,function*(){y.value=!0;try{const s=yield Re(p);s.success&&(_.value=s.data,r.value=s.pagination.total)}finally{y.value=!1}}),K=()=>{L.value="添加网站",Object.assign(o,{name:"",url:"",crawl_depth:3,max_links:1e3}),delete o.id,x.value=!0},X=s=>{L.value="编辑网站",Object.assign(o,{id:s.id,name:s.name,url:s.url,crawl_depth:s.crawl_depth,max_links:s.max_links}),x.value=!0},Y=()=>C(null,null,function*(){h.value&&(yield h.value.validate(s=>C(null,null,function*(){if(s)try{if(o.id){const e=o,{id:c}=e,B=G(e,["id"]);yield Q(c,B),b.success("更新成功")}else yield Be(o),b.success("添加成功");x.value=!1,k()}catch(c){}})))}),Z=s=>C(null,null,function*(){try{const e=s.status==="active"?"inactive":"active";yield Q(s.id,{status:e}),b.success("状态更新成功"),k()}catch(e){}}),ee=s=>{Ue.confirm(`确定要删除网站"${s.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>C(null,null,function*(){try{yield Se(s.id),b.success("删除成功"),k()}catch(e){}})).catch(()=>{})},te=s=>{p.page=s,k()},le=()=>{p.page=1,k()},ae=()=>{p.status="",p.page=1,k()},S=v(!1),z=v(),M=v(!1),u=v(null),se=()=>{u.value=null,S.value=!0},oe=s=>s.type==="text/csv"||s.name.endsWith(".csv")?s.size/1024/1024<10?!0:(b.error("文件大小不能超过10MB"),!1):(b.error("只能上传CSV文件"),!1),ne=s=>C(null,null,function*(){M.value=!0;try{const e=yield ze(s.file);u.value=e.data,e.success&&(b.success(e.message||"导入成功"),k())}catch(e){b.error(e.message||"导入失败")}finally{M.value=!1}}),ie=()=>{const s=`name,url,depth,maxLinks
示例网站,https://example.com,3,1000`,e=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),B=URL.createObjectURL(e);c.setAttribute("href",B),c.setAttribute("download","website_import_template.csv"),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)},$=()=>{S.value=!1,z.value&&z.value.clearFiles(),u.value=null};return ye(()=>{k()}),(s,e)=>{const c=n("el-option"),B=n("el-select"),m=n("el-button"),j=n("el-card"),w=n("el-table-column"),q=n("el-tag"),ue=n("el-table"),re=n("el-pagination"),I=n("el-input"),T=n("el-form-item"),N=n("el-input-number"),de=n("el-form"),A=n("el-dialog"),O=n("el-alert"),pe=n("el-icon"),ce=n("el-upload"),me=n("el-divider"),E=n("el-descriptions-item"),_e=n("el-descriptions"),fe=we("loading");return V(),U("div",Te,[t(j,{class:"mb-4"},{default:l(()=>[d("div",We,[d("div",De,[e[10]||(e[10]=d("span",{class:"text-sm whitespace-nowrap"},"状态",-1)),t(B,{modelValue:p.status,"onUpdate:modelValue":e[0]||(e[0]=a=>p.status=a),placeholder:"请选择状态",style:{width:"150px"},clearable:""},{default:l(()=>[t(c,{label:"激活",value:"active"}),t(c,{label:"停用",value:"inactive"})]),_:1},8,["modelValue"])]),d("div",Fe,[t(m,{type:"primary",onClick:le},{default:l(()=>e[11]||(e[11]=[i("查询",-1)])),_:1,__:[11]}),t(m,{onClick:ae},{default:l(()=>e[12]||(e[12]=[i("重置",-1)])),_:1,__:[12]}),t(m,{type:"success",onClick:K},{default:l(()=>e[13]||(e[13]=[i("添加网站",-1)])),_:1,__:[13]}),t(m,{type:"warning",icon:D(xe),onClick:se},{default:l(()=>e[14]||(e[14]=[i(" 批量导入 ",-1)])),_:1,__:[14]},8,["icon"])])])]),_:1}),t(j,null,{default:l(()=>[ke((V(),J(ue,{data:_.value,stripe:""},{default:l(()=>[t(w,{prop:"name",label:"网站名称","min-width":"120"}),t(w,{prop:"url",label:"URL","min-width":"200","show-overflow-tooltip":""}),t(w,{prop:"domain",label:"域名","min-width":"150"}),t(w,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[t(q,{type:a.status==="active"?"success":"info"},{default:l(()=>[i(g(a.status==="active"?"激活":"停用"),1)]),_:2},1032,["type"])]),_:1}),t(w,{prop:"crawl_depth",label:"爬取深度",width:"100"}),t(w,{prop:"max_links",label:"最大链接数",width:"120"}),t(w,{prop:"created_at",label:"创建时间",width:"180"},{default:l(({row:a})=>[i(g(D(Me)(a.created_at)),1)]),_:1}),t(w,{label:"操作",width:"250",fixed:"right"},{default:l(({row:a})=>[t(m,{type:"primary",size:"small",onClick:W=>X(a)},{default:l(()=>e[15]||(e[15]=[i(" 编辑 ",-1)])),_:2,__:[15]},1032,["onClick"]),t(m,{type:a.status==="active"?"warning":"success",size:"small",onClick:W=>Z(a)},{default:l(()=>[i(g(a.status==="active"?"停用":"激活"),1)]),_:2},1032,["type","onClick"]),t(m,{type:"danger",size:"small",onClick:W=>ee(a)},{default:l(()=>e[16]||(e[16]=[i(" 删除 ",-1)])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[fe,y.value]]),d("div",qe,[t(re,{"current-page":p.page,"onUpdate:currentPage":e[1]||(e[1]=a=>p.page=a),"page-size":p.page_size,total:r.value,layout:"total, prev, pager, next, jumper",onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1}),t(A,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=a=>x.value=a),title:L.value,width:"600px","close-on-click-modal":!1},{footer:l(()=>[t(m,{onClick:e[6]||(e[6]=a=>x.value=!1)},{default:l(()=>e[17]||(e[17]=[i("取消",-1)])),_:1,__:[17]}),t(m,{type:"primary",onClick:Y},{default:l(()=>e[18]||(e[18]=[i("确定",-1)])),_:1,__:[18]})]),default:l(()=>[t(de,{ref_key:"formRef",ref:h,model:o,rules:R,"label-width":"120px"},{default:l(()=>[t(T,{label:"网站名称",prop:"name"},{default:l(()=>[t(I,{modelValue:o.name,"onUpdate:modelValue":e[2]||(e[2]=a=>o.name=a),placeholder:"请输入网站名称"},null,8,["modelValue"])]),_:1}),t(T,{label:"网站URL",prop:"url"},{default:l(()=>[t(I,{modelValue:o.url,"onUpdate:modelValue":e[3]||(e[3]=a=>o.url=a),placeholder:"请输入完整URL（包含 http:// 或 https://）"},null,8,["modelValue"])]),_:1}),t(T,{label:"爬取深度",prop:"crawl_depth"},{default:l(()=>[t(N,{modelValue:o.crawl_depth,"onUpdate:modelValue":e[4]||(e[4]=a=>o.crawl_depth=a),min:1,max:10,"controls-position":"right"},null,8,["modelValue"])]),_:1}),t(T,{label:"最大链接数",prop:"max_links"},{default:l(()=>[t(N,{modelValue:o.max_links,"onUpdate:modelValue":e[5]||(e[5]=a=>o.max_links=a),min:100,max:1e5,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(A,{modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=a=>S.value=a),title:"批量导入网站",width:"600px","close-on-click-modal":!1,onClose:$},{footer:l(()=>[t(m,{onClick:$},{default:l(()=>[i(g(u.value?"关闭":"取消"),1)]),_:1}),u.value?F("",!0):(V(),J(m,{key:0,type:"primary",loading:M.value,onClick:e[8]||(e[8]=a=>z.value.submit())},{default:l(()=>[i(g(M.value?"导入中...":"开始导入"),1)]),_:1},8,["loading"]))]),default:l(()=>[d("div",Ee,[t(O,{title:"导入说明",type:"info",closable:!1,class:"mb-4"},{default:l(()=>e[19]||(e[19]=[d("p",null,"1. CSV文件必须包含表头: name, url, depth, maxLinks",-1),d("p",null,"2. name和url是必填字段，depth和maxLinks是可选字段",-1),d("p",null,"3. depth默认为3，maxLinks默认为1000",-1),d("p",null,"4. 文件大小不能超过10MB",-1)])),_:1,__:[19]}),t(m,{type:"primary",size:"small",onClick:ie},{default:l(()=>e[20]||(e[20]=[i(" 下载模板文件 ",-1)])),_:1,__:[20]})]),t(ce,{ref_key:"uploadRef",ref:z,drag:"","auto-upload":!1,limit:1,accept:".csv","before-upload":oe,"http-request":ne,"on-exceed":()=>D(b).warning("只能上传一个文件")},{tip:l(()=>e[21]||(e[21]=[d("div",{class:"el-upload__tip"},"只支持CSV格式文件，且不超过10MB",-1)])),default:l(()=>[t(pe,{class:"el-icon--upload"},{default:l(()=>[t(D(Ve))]),_:1}),e[22]||(e[22]=d("div",{class:"el-upload__text"},[i(" 将CSV文件拖到此处，或"),d("em",null,"点击上传")],-1))]),_:1,__:[22]},8,["on-exceed"]),u.value?(V(),U("div",$e,[t(me,null,{default:l(()=>e[23]||(e[23]=[i("导入结果",-1)])),_:1,__:[23]}),t(_e,{column:3,border:""},{default:l(()=>[t(E,{label:"总计"},{default:l(()=>[i(g(u.value.total),1)]),_:1}),t(E,{label:"成功"},{default:l(()=>[t(q,{type:"success"},{default:l(()=>[i(g(u.value.success_count),1)]),_:1})]),_:1}),t(E,{label:"失败"},{default:l(()=>[t(q,{type:"danger"},{default:l(()=>[i(g(u.value.failed_count),1)]),_:1})]),_:1})]),_:1}),u.value.errors.length>0?(V(),U("div",je,[t(O,{title:"导入失败详情",type:"error",closable:!1},{default:l(()=>[d("ul",Ie,[(V(!0),U(he,null,Ce(u.value.errors,(a,W)=>(V(),U("li",{key:W},g(a),1))),128)),u.value.failed_count>u.value.errors.length?(V(),U("li",Ne," ... 还有 "+g(u.value.failed_count-u.value.errors.length)+" 条错误未显示 ",1)):F("",!0)])]),_:1})])):F("",!0)])):F("",!0)]),_:1},8,["modelValue"])])}}}),Je=Le(Ae,[["__scopeId","data-v-46f3bfe0"]]);export{Je as default};
