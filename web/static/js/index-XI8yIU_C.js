var C=(y,w,o)=>new Promise((m,l)=>{var x=u=>{try{c(o.next(u))}catch(p){l(p)}},k=u=>{try{c(o.throw(u))}catch(p){l(p)}},c=u=>u.done?m(u.value):Promise.resolve(u.value).then(x,k);c((o=o.apply(y,w)).next())});import{az as L,v as R,r as M,h as T,i as W,c as N,o as v,J as t,I as j,V as F,H as G,S as a,b as n,G as r,M as H,N as J,T as f,aa as P,R as h,ax as S,_ as Q}from"./index-BOVhXILd.js";import{g as $}from"./websites-D8arv4Qz.js";const K=y=>L.request("get","/statistics",{params:y}),O={class:"statistics"},X={class:"flex flex-wrap items-center gap-4"},Z={class:"flex items-center gap-2"},ee={class:"flex items-center gap-2"},te={class:"flex items-center gap-2"},ae={class:"flex items-center justify-between"},le={class:"text-base font-semibold"},se={class:"mb-6"},oe={class:"mb-6"},ne=R({name:"Statistics",__name:"index",setup(y){const w=M([]),o=T({website_id:"",date_from:"",date_to:""}),m=M(!1),l=M(null),x=[{text:"最近7天",value:()=>{const s=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,s]}},{text:"最近30天",value:()=>{const s=new Date,e=new Date;return e.setDate(e.getDate()-30),[e,s]}},{text:"最近3个月",value:()=>{const s=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,s]}}],k=()=>C(null,null,function*(){try{const s=yield $({status:"active"});s.success&&(w.value=s.data,s.data.length>0&&(o.website_id=s.data[0].id,c()))}catch(s){console.error("加载网站列表失败",s)}}),c=()=>C(null,null,function*(){if(!o.website_id){S.warning("请选择网站");return}m.value=!0;try{const s=yield K(o);s.success&&(l.value=s.data)}catch(s){S.error("加载统计数据失败")}finally{m.value=!1}}),u=()=>{c()},p=()=>{o.date_from="",o.date_to="",c()},g=s=>`${(s*100).toFixed(2)}%`;return W(()=>{k()}),(s,e)=>{const B=r("el-option"),U=r("el-select"),E=r("el-date-picker"),z=r("el-button"),b=r("el-card"),D=r("el-text"),Y=r("el-divider"),i=r("el-statistic"),d=r("el-col"),V=r("el-row"),A=r("el-progress"),q=r("el-empty"),I=P("loading");return v(),N("div",O,[t(b,{class:"mb-4"},{default:a(()=>[n("div",X,[n("div",Z,[e[3]||(e[3]=n("span",{class:"text-sm whitespace-nowrap"},"网站",-1)),t(U,{modelValue:o.website_id,"onUpdate:modelValue":e[0]||(e[0]=_=>o.website_id=_),placeholder:"请选择网站",style:{width:"200px"}},{default:a(()=>[(v(!0),N(H,null,J(w.value,_=>(v(),F(B,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",ee,[e[4]||(e[4]=n("span",{class:"text-sm whitespace-nowrap"},"日期范围",-1)),t(E,{modelValue:o.date_from,"onUpdate:modelValue":e[1]||(e[1]=_=>o.date_from=_),type:"date",placeholder:"开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",shortcuts:x,style:{width:"150px"}},null,8,["modelValue"]),e[5]||(e[5]=n("span",{class:"text-sm text-gray-500"},"至",-1)),t(E,{modelValue:o.date_to,"onUpdate:modelValue":e[2]||(e[2]=_=>o.date_to=_),type:"date",placeholder:"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",shortcuts:x,style:{width:"150px"}},null,8,["modelValue"])]),n("div",te,[t(z,{type:"primary",onClick:u},{default:a(()=>e[6]||(e[6]=[f("查询",-1)])),_:1,__:[6]}),t(z,{onClick:p},{default:a(()=>e[7]||(e[7]=[f("重置",-1)])),_:1,__:[7]})])])]),_:1}),l.value?j((v(),F(b,{key:0},{header:a(()=>[n("div",ae,[n("span",le,"统计概览 - "+h(l.value.website.name),1),t(D,{type:"info",size:"small"},{default:a(()=>[f(" 统计周期: "+h(l.value.period.from)+" ~ "+h(l.value.period.to),1)]),_:1})])]),default:a(()=>[n("div",se,[t(Y,{"content-position":"left"},{default:a(()=>e[8]||(e[8]=[n("span",{class:"text-base font-semibold"},"任务统计",-1)])),_:1,__:[8]}),t(V,{gutter:20},{default:a(()=>[t(d,{span:6},{default:a(()=>[t(i,{title:"总任务数",value:l.value.summary.total_tasks,"value-style":"color: #409EFF"},null,8,["value"])]),_:1}),t(d,{span:6},{default:a(()=>[t(i,{title:"已完成任务",value:l.value.summary.completed_tasks,"value-style":"color: #67C23A"},null,8,["value"])]),_:1}),t(d,{span:6},{default:a(()=>[t(i,{title:"失败任务",value:l.value.summary.failed_tasks,"value-style":"color: #F56C6C"},null,8,["value"])]),_:1}),t(d,{span:6},{default:a(()=>[t(i,{title:"任务成功率",value:l.value.summary.total_tasks>0?g(l.value.summary.completed_tasks/l.value.summary.total_tasks):"0%","value-style":"color: #67C23A"},null,8,["value"])]),_:1})]),_:1})]),n("div",oe,[t(Y,{"content-position":"left"},{default:a(()=>e[9]||(e[9]=[n("span",{class:"text-base font-semibold"},"链接统计",-1)])),_:1,__:[9]}),t(V,{gutter:20},{default:a(()=>[t(d,{span:8},{default:a(()=>[t(i,{title:"总爬取链接数",value:l.value.summary.total_links_crawled,"value-style":"color: #409EFF"},null,8,["value"])]),_:1}),t(d,{span:8},{default:a(()=>[t(i,{title:"新增链接数",value:l.value.summary.new_links_found,"value-style":"color: #E6A23C"},null,8,["value"])]),_:1}),t(d,{span:8},{default:a(()=>[t(i,{title:"平均新增率",value:l.value.summary.total_links_crawled>0?g(l.value.summary.new_links_found/l.value.summary.total_links_crawled):"0%","value-style":"color: #E6A23C"},null,8,["value"])]),_:1})]),_:1})]),n("div",null,[t(Y,{"content-position":"left"},{default:a(()=>e[10]||(e[10]=[n("span",{class:"text-base font-semibold"},"质量统计",-1)])),_:1,__:[10]}),t(V,{gutter:20},{default:a(()=>[t(d,{span:12},{default:a(()=>[t(b,{shadow:"never",class:"text-center"},{default:a(()=>[t(i,{title:"平均有效率",value:g(l.value.summary.avg_valid_rate),"value-style":"color: #67C23A; font-size: 32px"},null,8,["value"]),t(A,{percentage:l.value.summary.avg_valid_rate*100,"stroke-width":20,class:"mt-4"},null,8,["percentage"]),t(D,{type:"info",size:"small",class:"mt-2"},{default:a(()=>e[11]||(e[11]=[f(" 有效链接占总链接的比例 ",-1)])),_:1,__:[11]})]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(b,{shadow:"never",class:"text-center"},{default:a(()=>[t(i,{title:"平均精准率",value:g(l.value.summary.avg_precision_rate),"value-style":"color: #409EFF; font-size: 32px"},null,8,["value"]),t(A,{percentage:l.value.summary.avg_precision_rate*100,"stroke-width":20,color:"#409EFF",class:"mt-4"},null,8,["percentage"]),t(D,{type:"info",size:"small",class:"mt-2"},{default:a(()=>e[12]||(e[12]=[f(" 成功下载占有效链接的比例 ",-1)])),_:1,__:[12]})]),_:1})]),_:1})]),_:1})])]),_:1})),[[I,m.value]]):m.value?G("",!0):(v(),F(q,{key:1,description:"请选择网站查看统计数据"}))])}}}),de=Q(ne,[["__scopeId","data-v-f62cd013"]]);export{de as default};
