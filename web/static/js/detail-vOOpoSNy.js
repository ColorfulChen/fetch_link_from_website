var L=(V,R,p)=>new Promise((y,a)=>{var k=s=>{try{v(p.next(s))}catch(m){a(m)}},x=s=>{try{v(p.throw(s))}catch(m){a(m)}},v=s=>s.done?y(s.value):Promise.resolve(s.value).then(k,x);v((p=p.apply(V,R)).next())});import{v as X,r as w,h as Y,l as Z,i as ee,c as te,o as d,J as e,I as O,V as b,H as h,S as t,b as _,G as o,aa as ae,T as i,R as r,ax as j,k as le,_ as se}from"./index-Cghf-nif.js";import{b as oe,e as ne}from"./tasks-2eQTdq5x.js";const ie={class:"task-detail"},re={class:"flex items-center justify-between"},ue={class:"flex items-center justify-between"},ce={class:"mt-4 flex justify-end"},de=X({name:"TaskDetail",__name:"detail",setup(V){const R=Z(),p=le(),y=w(!1),a=w(null),k=w(!1),x=w([]),v=w(0),s=Y({level:"",page:1,page_size:50}),m=R.params.id,A=l=>({pending:"info",running:"warning",completed:"success",failed:"danger"})[l]||"info",G=l=>({INFO:"info",WARNING:"warning",ERROR:"danger"})[l]||"info",z=l=>`${(l*100).toFixed(2)}%`,N=l=>l?new Date(l).toLocaleString():"-",S=()=>L(null,null,function*(){y.value=!0;try{const l=yield oe(m);l.success&&(a.value=l.data)}catch(l){j.error("加载任务详情失败")}finally{y.value=!1}}),C=()=>L(null,null,function*(){k.value=!0;try{const l=yield ne(m,s);l.success&&(x.value=l.data,v.value=l.pagination.total)}catch(l){j.error("加载任务日志失败")}finally{k.value=!1}}),P=()=>{p.back()},W=l=>{s.page=l,C()},M=()=>{s.page=1,C()};return ee(()=>{S(),C()}),(l,n)=>{const U=o("el-page-header"),I=o("el-tag"),c=o("el-descriptions-item"),H=o("el-text"),J=o("el-descriptions"),D=o("el-card"),f=o("el-statistic"),g=o("el-col"),B=o("el-row"),Q=o("el-divider"),T=o("el-option"),$=o("el-select"),F=o("el-table-column"),q=o("el-table"),K=o("el-pagination"),E=ae("loading");return d(),te("div",ie,[e(U,{onBack:P},{content:t(()=>n[2]||(n[2]=[_("span",{class:"text-lg font-semibold"},"任务详情",-1)])),_:1}),O((d(),b(D,{class:"mt-4"},{header:t(()=>[_("div",re,[n[3]||(n[3]=_("span",{class:"text-base font-semibold"},"基本信息",-1)),a.value?(d(),b(I,{key:0,type:A(a.value.status),size:"large"},{default:t(()=>[i(r(a.value.status),1)]),_:1},8,["type"])):h("",!0)])]),default:t(()=>[a.value?(d(),b(J,{key:0,column:2,border:""},{default:t(()=>[e(c,{label:"任务ID"},{default:t(()=>[i(r(a.value.id),1)]),_:1}),e(c,{label:"网站ID"},{default:t(()=>[i(r(a.value.website_id),1)]),_:1}),e(c,{label:"任务类型"},{default:t(()=>[i(r(a.value.task_type==="manual"?"手动":"定时"),1)]),_:1}),e(c,{label:"爬取策略"},{default:t(()=>[e(I,{type:a.value.strategy==="incremental"?"success":"warning"},{default:t(()=>[i(r(a.value.strategy==="incremental"?"增量":"全量"),1)]),_:1},8,["type"])]),_:1}),e(c,{label:"开始时间"},{default:t(()=>[i(r(N(a.value.started_at)),1)]),_:1}),e(c,{label:"完成时间"},{default:t(()=>[i(r(N(a.value.completed_at)),1)]),_:1}),a.value.error_message?(d(),b(c,{key:0,label:"错误信息",span:2},{default:t(()=>[e(H,{type:"danger"},{default:t(()=>[i(r(a.value.error_message),1)]),_:1})]),_:1})):h("",!0)]),_:1})):h("",!0)]),_:1})),[[E,y.value]]),a.value?(d(),b(D,{key:0,class:"mt-4"},{header:t(()=>n[4]||(n[4]=[_("span",{class:"text-base font-semibold"},"统计信息",-1)])),default:t(()=>[e(B,{gutter:20},{default:t(()=>[e(g,{span:6},{default:t(()=>[e(f,{title:"总链接数",value:a.value.statistics.total_links},null,8,["value"])]),_:1}),e(g,{span:6},{default:t(()=>[e(f,{title:"有效链接数",value:a.value.statistics.valid_links,"value-style":"color: #67C23A"},null,8,["value"])]),_:1}),e(g,{span:6},{default:t(()=>[e(f,{title:"无效链接数",value:a.value.statistics.invalid_links,"value-style":"color: #F56C6C"},null,8,["value"])]),_:1}),e(g,{span:6},{default:t(()=>[e(f,{title:"新增链接数",value:a.value.statistics.new_links,"value-style":"color: #409EFF"},null,8,["value"])]),_:1})]),_:1}),e(Q),e(B,{gutter:20},{default:t(()=>[e(g,{span:12},{default:t(()=>[e(f,{title:"有效率",value:z(a.value.statistics.valid_rate)},null,8,["value"])]),_:1}),e(g,{span:12},{default:t(()=>[e(f,{title:"精准率",value:z(a.value.statistics.precision_rate)},null,8,["value"])]),_:1})]),_:1})]),_:1})):h("",!0),e(D,{class:"mt-4"},{header:t(()=>[_("div",ue,[n[5]||(n[5]=_("span",{class:"text-base font-semibold"},"任务日志",-1)),e($,{modelValue:s.level,"onUpdate:modelValue":n[0]||(n[0]=u=>s.level=u),placeholder:"筛选日志级别",clearable:"",style:{width:"150px"},onChange:M},{default:t(()=>[e(T,{label:"INFO",value:"INFO"}),e(T,{label:"WARNING",value:"WARNING"}),e(T,{label:"ERROR",value:"ERROR"})]),_:1},8,["modelValue"])])]),default:t(()=>[O((d(),b(q,{data:x.value,stripe:"","max-height":"500"},{default:t(()=>[e(F,{prop:"level",label:"级别",width:"100"},{default:t(({row:u})=>[e(I,{type:G(u.level),size:"small"},{default:t(()=>[i(r(u.level),1)]),_:2},1032,["type"])]),_:1}),e(F,{prop:"message",label:"消息","min-width":"400","show-overflow-tooltip":""}),e(F,{prop:"created_at",label:"时间",width:"180"},{default:t(({row:u})=>[i(r(N(u.created_at)),1)]),_:1})]),_:1},8,["data"])),[[E,k.value]]),_("div",ce,[e(K,{"current-page":s.page,"onUpdate:currentPage":n[1]||(n[1]=u=>s.page=u),"page-size":s.page_size,total:v.value,layout:"total, prev, pager, next, jumper",onCurrentChange:W},null,8,["current-page","page-size","total"])])]),_:1})])}}}),me=se(de,[["__scopeId","data-v-c6bcf413"]]);export{me as default};
