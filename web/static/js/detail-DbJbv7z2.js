var V=(L,C,v)=>new Promise((y,a)=>{var h=o=>{try{m(v.next(o))}catch(f){a(f)}},w=o=>{try{m(v.throw(o))}catch(f){a(f)}},m=o=>o.done?y(o.value):Promise.resolve(o.value).then(h,w);m((v=v.apply(L,C)).next())});import{v as Z,r as k,h as ee,l as te,i as ae,c as le,o as d,J as e,I as O,V as p,H as x,S as t,b as i,G as s,aa as se,T as r,R as u,p as N,az as oe,ax as j,k as ne,_ as ie}from"./index-BF9pO7mF.js";import{b as re,e as ue}from"./tasks-CfFLVJ1S.js";import{f as F}from"./time-DxhBYzk3.js";const ce={class:"task-detail"},de={class:"flex items-center justify-between"},_e={class:"screenshot-container"},pe={class:"image-slot"},ve={class:"flex items-center justify-between"},me={class:"mt-4 flex justify-end"},fe=Z({name:"TaskDetail",__name:"detail",setup(L){const C=te(),v=ne(),y=k(!1),a=k(null),h=k(!1),w=k([]),m=k(0),o=ee({level:"",page:1,page_size:50}),f=C.params.id,A=n=>({pending:"info",running:"warning",completed:"success",failed:"danger"})[n]||"info",G=n=>({INFO:"info",WARNING:"warning",ERROR:"danger"})[n]||"info",S=()=>V(null,null,function*(){y.value=!0;try{const n=yield re(f);n.success&&(a.value=n.data)}catch(n){j.error("加载任务详情失败")}finally{y.value=!1}}),I=()=>V(null,null,function*(){h.value=!0;try{const n=yield ue(f,o);n.success&&(w.value=n.data,m.value=n.pagination.total)}catch(n){j.error("加载任务日志失败")}finally{h.value=!1}}),W=()=>{v.back()},M=n=>{o.page=n,I()},P=()=>{o.page=1,I()};return ae(()=>{S(),I()}),(n,l)=>{const U=s("el-page-header"),T=s("el-tag"),_=s("el-descriptions-item"),$=s("el-text"),H=s("el-descriptions"),R=s("el-card"),g=s("el-statistic"),b=s("el-col"),B=s("el-row"),J=s("el-divider"),Q=s("el-icon"),q=s("el-image"),D=s("el-option"),K=s("el-select"),z=s("el-table-column"),X=s("el-table"),Y=s("el-pagination"),E=se("loading");return d(),le("div",ce,[e(U,{onBack:W},{content:t(()=>l[2]||(l[2]=[i("span",{class:"text-lg font-semibold"},"任务详情",-1)])),_:1}),O((d(),p(R,{class:"mt-4"},{header:t(()=>[i("div",de,[l[3]||(l[3]=i("span",{class:"text-base font-semibold"},"基本信息",-1)),a.value?(d(),p(T,{key:0,type:A(a.value.status),size:"large"},{default:t(()=>[r(u(a.value.status),1)]),_:1},8,["type"])):x("",!0)])]),default:t(()=>[a.value?(d(),p(H,{key:0,column:2,border:""},{default:t(()=>[e(_,{label:"任务ID"},{default:t(()=>[r(u(a.value.id),1)]),_:1}),e(_,{label:"网站ID"},{default:t(()=>[r(u(a.value.website_id),1)]),_:1}),e(_,{label:"任务类型"},{default:t(()=>[r(u(a.value.task_type==="manual"?"手动":"定时"),1)]),_:1}),e(_,{label:"爬取策略"},{default:t(()=>[e(T,{type:a.value.strategy==="incremental"?"success":"warning"},{default:t(()=>[r(u(a.value.strategy==="incremental"?"增量":"全量"),1)]),_:1},8,["type"])]),_:1}),e(_,{label:"开始时间"},{default:t(()=>[r(u(N(F)(a.value.started_at)),1)]),_:1}),e(_,{label:"完成时间"},{default:t(()=>[r(u(N(F)(a.value.completed_at)),1)]),_:1}),a.value.error_message?(d(),p(_,{key:0,label:"错误信息",span:2},{default:t(()=>[e($,{type:"danger"},{default:t(()=>[r(u(a.value.error_message),1)]),_:1})]),_:1})):x("",!0)]),_:1})):x("",!0)]),_:1})),[[E,y.value]]),a.value?(d(),p(R,{key:0,class:"mt-4"},{header:t(()=>l[4]||(l[4]=[i("span",{class:"text-base font-semibold"},"统计信息",-1)])),default:t(()=>[e(B,{gutter:20},{default:t(()=>[e(b,{span:6},{default:t(()=>[e(g,{title:"总链接数",value:a.value.statistics.total_links},null,8,["value"])]),_:1}),e(b,{span:6},{default:t(()=>[e(g,{title:"有效链接数",value:a.value.statistics.valid_links,"value-style":"color: #67C23A"},null,8,["value"])]),_:1}),e(b,{span:6},{default:t(()=>[e(g,{title:"无效链接数",value:a.value.statistics.invalid_links,"value-style":"color: #F56C6C"},null,8,["value"])]),_:1}),e(b,{span:6},{default:t(()=>[e(g,{title:"新增链接数",value:a.value.statistics.new_links,"value-style":"color: #409EFF"},null,8,["value"])]),_:1})]),_:1}),e(J),e(B,{gutter:20},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(g,{title:"有效率",value:a.value.statistics.valid_rate*100,precision:2,suffix:"%"},null,8,["value"])]),_:1}),e(b,{span:12},{default:t(()=>[e(g,{title:"精准率",value:a.value.statistics.precision_rate*100,precision:2,suffix:"%"},null,8,["value"])]),_:1})]),_:1})]),_:1})):x("",!0),a.value&&a.value.screenshot_path?(d(),p(R,{key:1,class:"mt-4"},{header:t(()=>l[5]||(l[5]=[i("span",{class:"text-base font-semibold"},"网站截图",-1)])),default:t(()=>[i("div",_e,[e(q,{src:`/api/screenshots/${a.value.screenshot_path}`,"preview-src-list":[`/api/screenshots/${a.value.screenshot_path}`],fit:"contain",style:{"max-width":"100%","max-height":"600px"},lazy:""},{error:t(()=>[i("div",pe,[e(Q,null,{default:t(()=>[e(N(oe))]),_:1}),l[6]||(l[6]=i("span",null,"截图加载失败",-1))])]),_:1},8,["src","preview-src-list"])])]),_:1})):x("",!0),e(R,{class:"mt-4"},{header:t(()=>[i("div",ve,[l[7]||(l[7]=i("span",{class:"text-base font-semibold"},"任务日志",-1)),e(K,{modelValue:o.level,"onUpdate:modelValue":l[0]||(l[0]=c=>o.level=c),placeholder:"筛选日志级别",clearable:"",style:{width:"150px"},onChange:P},{default:t(()=>[e(D,{label:"INFO",value:"INFO"}),e(D,{label:"WARNING",value:"WARNING"}),e(D,{label:"ERROR",value:"ERROR"})]),_:1},8,["modelValue"])])]),default:t(()=>[O((d(),p(X,{data:w.value,stripe:"","max-height":"500"},{default:t(()=>[e(z,{prop:"level",label:"级别",width:"100"},{default:t(({row:c})=>[e(T,{type:G(c.level),size:"small"},{default:t(()=>[r(u(c.level),1)]),_:2},1032,["type"])]),_:1}),e(z,{prop:"message",label:"消息","min-width":"400","show-overflow-tooltip":""}),e(z,{prop:"created_at",label:"时间",width:"180"},{default:t(({row:c})=>[r(u(N(F)(c.created_at)),1)]),_:1})]),_:1},8,["data"])),[[E,h.value]]),i("div",me,[e(Y,{"current-page":o.page,"onUpdate:currentPage":l[1]||(l[1]=c=>o.page=c),"page-size":o.page_size,total:m.value,layout:"total, prev, pager, next, jumper",onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1})])}}}),ke=ie(fe,[["__scopeId","data-v-09bdfdd9"]]);export{ke as default};
