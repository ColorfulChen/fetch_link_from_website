var S=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var T=(d,c)=>{var u={};for(var o in d)X.call(d,o)&&c.indexOf(o)<0&&(u[o]=d[o]);if(d!=null&&S)for(var o of S(d))c.indexOf(o)<0&&Y.call(d,o)&&(u[o]=d[o]);return u};var b=(d,c,u)=>new Promise((o,i)=>{var m=l=>{try{f(u.next(l))}catch(w){i(w)}},y=l=>{try{f(u.throw(l))}catch(w){i(w)}},f=l=>l.done?o(l.value):Promise.resolve(l.value).then(m,y);f((u=u.apply(d,c)).next())});import{g as Z,u as W,c as ee,d as te}from"./websites-D8arv4Qz.js";import{v as ae,r as x,h as q,i as le,c as se,o as $,J as t,S as s,b as V,G as r,T as p,I as ne,aa as oe,V as ie,R,ax as C,ay as re,_ as ue}from"./index-BOVhXILd.js";const de={class:"website-manage"},pe={class:"flex flex-wrap items-center gap-4"},ce={class:"flex items-center gap-2"},me={class:"flex items-center gap-2"},_e={class:"mt-4 flex justify-end"},ge=ae({name:"WebsiteManage",__name:"index",setup(d){const c=x(!1),u=x([]),o=x(0),i=q({status:"",page:1,page_size:20}),m=x(!1),y=x("添加网站"),f=x(),l=q({name:"",url:"",crawl_depth:3,max_links:1e3}),w={name:[{required:!0,message:"请输入网站名称",trigger:"blur"}],url:[{required:!0,message:"请输入网站URL",trigger:"blur"},{type:"url",message:"请输入有效的URL",trigger:"blur"}],crawl_depth:[{required:!0,message:"请输入爬取深度",trigger:"blur"}],max_links:[{required:!0,message:"请输入最大链接数",trigger:"blur"}]},v=()=>b(null,null,function*(){c.value=!0;try{const n=yield Z(i);n.success&&(u.value=n.data,o.value=n.pagination.total)}finally{c.value=!1}}),j=()=>{y.value="添加网站",Object.assign(l,{name:"",url:"",crawl_depth:3,max_links:1e3}),delete l.id,m.value=!0},E=n=>{y.value="编辑网站",Object.assign(l,{id:n.id,name:n.name,url:n.url,crawl_depth:n.crawl_depth,max_links:n.max_links}),m.value=!0},M=()=>b(null,null,function*(){f.value&&(yield f.value.validate(n=>b(null,null,function*(){if(n)try{if(l.id){const e=l,{id:k}=e,U=T(e,["id"]);yield W(k,U),C.success("更新成功")}else yield ee(l),C.success("添加成功");m.value=!1,v()}catch(k){}})))}),N=n=>b(null,null,function*(){try{const e=n.status==="active"?"inactive":"active";yield W(n.id,{status:e}),C.success("状态更新成功"),v()}catch(e){}}),I=n=>{re.confirm(`确定要删除网站"${n.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>b(null,null,function*(){try{yield te(n.id),C.success("删除成功"),v()}catch(e){}})).catch(()=>{})},O=n=>{i.page=n,v()},P=()=>{i.page=1,v()},A=()=>{i.status="",i.page=1,v()};return le(()=>{v()}),(n,e)=>{const k=r("el-option"),U=r("el-select"),_=r("el-button"),z=r("el-card"),g=r("el-table-column"),F=r("el-tag"),G=r("el-table"),J=r("el-pagination"),B=r("el-input"),h=r("el-form-item"),D=r("el-input-number"),Q=r("el-form"),H=r("el-dialog"),K=oe("loading");return $(),se("div",de,[t(z,{class:"mb-4"},{default:s(()=>[V("div",pe,[V("div",ce,[e[8]||(e[8]=V("span",{class:"text-sm whitespace-nowrap"},"状态",-1)),t(U,{modelValue:i.status,"onUpdate:modelValue":e[0]||(e[0]=a=>i.status=a),placeholder:"请选择状态",style:{width:"150px"},clearable:""},{default:s(()=>[t(k,{label:"激活",value:"active"}),t(k,{label:"停用",value:"inactive"})]),_:1},8,["modelValue"])]),V("div",me,[t(_,{type:"primary",onClick:P},{default:s(()=>e[9]||(e[9]=[p("查询",-1)])),_:1,__:[9]}),t(_,{onClick:A},{default:s(()=>e[10]||(e[10]=[p("重置",-1)])),_:1,__:[10]}),t(_,{type:"success",onClick:j},{default:s(()=>e[11]||(e[11]=[p("添加网站",-1)])),_:1,__:[11]})])])]),_:1}),t(z,null,{default:s(()=>[ne(($(),ie(G,{data:u.value,stripe:""},{default:s(()=>[t(g,{prop:"name",label:"网站名称","min-width":"120"}),t(g,{prop:"url",label:"URL","min-width":"200","show-overflow-tooltip":""}),t(g,{prop:"domain",label:"域名","min-width":"150"}),t(g,{prop:"status",label:"状态",width:"100"},{default:s(({row:a})=>[t(F,{type:a.status==="active"?"success":"info"},{default:s(()=>[p(R(a.status==="active"?"激活":"停用"),1)]),_:2},1032,["type"])]),_:1}),t(g,{prop:"crawl_depth",label:"爬取深度",width:"100"}),t(g,{prop:"max_links",label:"最大链接数",width:"120"}),t(g,{prop:"created_at",label:"创建时间",width:"180"},{default:s(({row:a})=>[p(R(new Date(a.created_at).toLocaleString()),1)]),_:1}),t(g,{label:"操作",width:"250",fixed:"right"},{default:s(({row:a})=>[t(_,{type:"primary",size:"small",onClick:L=>E(a)},{default:s(()=>e[12]||(e[12]=[p(" 编辑 ",-1)])),_:2,__:[12]},1032,["onClick"]),t(_,{type:a.status==="active"?"warning":"success",size:"small",onClick:L=>N(a)},{default:s(()=>[p(R(a.status==="active"?"停用":"激活"),1)]),_:2},1032,["type","onClick"]),t(_,{type:"danger",size:"small",onClick:L=>I(a)},{default:s(()=>e[13]||(e[13]=[p(" 删除 ",-1)])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,c.value]]),V("div",_e,[t(J,{"current-page":i.page,"onUpdate:currentPage":e[1]||(e[1]=a=>i.page=a),"page-size":i.page_size,total:o.value,layout:"total, prev, pager, next, jumper",onCurrentChange:O},null,8,["current-page","page-size","total"])])]),_:1}),t(H,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a),title:y.value,width:"600px","close-on-click-modal":!1},{footer:s(()=>[t(_,{onClick:e[6]||(e[6]=a=>m.value=!1)},{default:s(()=>e[14]||(e[14]=[p("取消",-1)])),_:1,__:[14]}),t(_,{type:"primary",onClick:M},{default:s(()=>e[15]||(e[15]=[p("确定",-1)])),_:1,__:[15]})]),default:s(()=>[t(Q,{ref_key:"formRef",ref:f,model:l,rules:w,"label-width":"120px"},{default:s(()=>[t(h,{label:"网站名称",prop:"name"},{default:s(()=>[t(B,{modelValue:l.name,"onUpdate:modelValue":e[2]||(e[2]=a=>l.name=a),placeholder:"请输入网站名称"},null,8,["modelValue"])]),_:1}),t(h,{label:"网站URL",prop:"url"},{default:s(()=>[t(B,{modelValue:l.url,"onUpdate:modelValue":e[3]||(e[3]=a=>l.url=a),placeholder:"请输入完整URL（包含 http:// 或 https://）"},null,8,["modelValue"])]),_:1}),t(h,{label:"爬取深度",prop:"crawl_depth"},{default:s(()=>[t(D,{modelValue:l.crawl_depth,"onUpdate:modelValue":e[4]||(e[4]=a=>l.crawl_depth=a),min:1,max:10,"controls-position":"right"},null,8,["modelValue"])]),_:1}),t(h,{label:"最大链接数",prop:"max_links"},{default:s(()=>[t(D,{modelValue:l.max_links,"onUpdate:modelValue":e[5]||(e[5]=a=>l.max_links=a),min:100,max:1e5,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),xe=ue(ge,[["__scopeId","data-v-d126f61e"]]);export{xe as default};
