var $=Object.defineProperty,j=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var N=(s,n,a)=>n in s?$(s,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[n]=a,E=(s,n)=>{for(var a in n||(n={}))I.call(n,a)&&N(s,a,n[a]);if(H)for(var a of H(n))O.call(n,a)&&N(s,a,n[a]);return s},h=(s,n)=>j(s,G(n));var V=(s,n,a)=>new Promise((_,o)=>{var C=i=>{try{w(a.next(i))}catch(v){o(v)}},b=i=>{try{w(a.throw(i))}catch(v){o(v)}},w=i=>i.done?_(i.value):Promise.resolve(i.value).then(C,b);w((a=a.apply(s,n)).next())});import{az as Z,v as A,r as k,h as K,i as P,c as q,o as x,J as t,V as U,H as B,S as l,G as d,M as Q,N as X,T as f,b as S,ax as z,_ as ee}from"./index-BOVhXILd.js";import{g as te}from"./websites-D8arv4Qz.js";const le=s=>Z.request("post","/export",{data:s}),F=s=>`/api/export/download/${s}`,ae={class:"data-export"},oe=A({name:"DataExport",__name:"index",setup(s){const n=k([]),a=k([]),_=k(),o=K({website_id:"",export_type:"full",format:"csv",since_date:"",filters:{}}),C={website_id:[{required:!0,message:"请选择网站",trigger:"change"}],export_type:[{required:!0,message:"请选择导出类型",trigger:"change"}],format:[{required:!0,message:"请选择导出格式",trigger:"change"}]},b=k(!1),w=()=>V(null,null,function*(){try{const u=yield te({status:"active"});u.success&&(n.value=u.data)}catch(u){console.error("加载网站列表失败",u)}}),i=()=>V(null,null,function*(){_.value&&(yield _.value.validate(u=>V(null,null,function*(){var e;if(u){b.value=!0;try{const p=yield le(o);if(p.success){z.success("导出成功"),a.value.unshift(h(E({},p.data),{export_time:new Date().toLocaleString(),website_name:((e=n.value.find(m=>m.id===o.website_id))==null?void 0:e.name)||""}));const y=F(p.data.file_name);window.open(y,"_blank")}}catch(p){z.error(p.message||"导出失败")}finally{b.value=!1}}})))}),v=u=>{const e=F(u);window.open(e,"_blank")},L=()=>{_.value&&_.value.resetFields()};return P(()=>{w()}),(u,e)=>{const p=d("el-option"),y=d("el-select"),m=d("el-form-item"),g=d("el-radio"),Y=d("el-radio-group"),R=d("el-date-picker"),T=d("el-input"),D=d("el-button"),J=d("el-form"),M=d("el-card"),c=d("el-table-column"),W=d("el-table");return x(),q("div",ae,[t(M,null,{header:l(()=>e[6]||(e[6]=[S("span",{class:"text-base font-semibold"},"数据导出",-1)])),default:l(()=>[t(J,{ref_key:"formRef",ref:_,model:o,rules:C,"label-width":"120px",style:{"max-width":"600px"}},{default:l(()=>[t(m,{label:"选择网站",prop:"website_id"},{default:l(()=>[t(y,{modelValue:o.website_id,"onUpdate:modelValue":e[0]||(e[0]=r=>o.website_id=r),placeholder:"请选择网站",style:{width:"100%"}},{default:l(()=>[(x(!0),q(Q,null,X(n.value,r=>(x(),U(p,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"导出类型",prop:"export_type"},{default:l(()=>[t(Y,{modelValue:o.export_type,"onUpdate:modelValue":e[1]||(e[1]=r=>o.export_type=r)},{default:l(()=>[t(g,{label:"full"},{default:l(()=>e[7]||(e[7]=[f("全量导出（所有历史链接）",-1)])),_:1,__:[7]}),t(g,{label:"incremental"},{default:l(()=>e[8]||(e[8]=[f("增量导出（指定日期后的新链接）",-1)])),_:1,__:[8]})]),_:1},8,["modelValue"])]),_:1}),o.export_type==="incremental"?(x(),U(m,{key:0,label:"起始日期",prop:"since_date"},{default:l(()=>[t(R,{modelValue:o.since_date,"onUpdate:modelValue":e[2]||(e[2]=r=>o.since_date=r),type:"datetime",placeholder:"选择起始日期",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DDTHH:mm:ss[Z]",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):B("",!0),t(m,{label:"导出格式",prop:"format"},{default:l(()=>[t(Y,{modelValue:o.format,"onUpdate:modelValue":e[3]||(e[3]=r=>o.format=r)},{default:l(()=>[t(g,{label:"csv"},{default:l(()=>e[9]||(e[9]=[f("CSV 格式",-1)])),_:1,__:[9]}),t(g,{label:"json"},{default:l(()=>e[10]||(e[10]=[f("JSON 格式",-1)])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"链接类型"},{default:l(()=>[t(y,{modelValue:o.filters.link_type,"onUpdate:modelValue":e[4]||(e[4]=r=>o.filters.link_type=r),placeholder:"全部",clearable:"",style:{width:"100%"}},{default:l(()=>[t(p,{label:"有效链接",value:"valid"}),t(p,{label:"无效链接",value:"invalid"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"域名过滤"},{default:l(()=>[t(T,{modelValue:o.filters.domain,"onUpdate:modelValue":e[5]||(e[5]=r=>o.filters.domain=r),placeholder:"输入域名进行过滤（可选）",clearable:""},null,8,["modelValue"])]),_:1}),t(m,null,{default:l(()=>[t(D,{type:"primary",onClick:i,loading:b.value},{default:l(()=>e[11]||(e[11]=[f(" 开始导出 ",-1)])),_:1,__:[11]},8,["loading"]),t(D,{onClick:L},{default:l(()=>e[12]||(e[12]=[f("重置",-1)])),_:1,__:[12]})]),_:1})]),_:1},8,["model"])]),_:1}),a.value.length>0?(x(),U(M,{key:0,class:"mt-4"},{header:l(()=>e[13]||(e[13]=[S("span",{class:"text-base font-semibold"},"导出历史",-1)])),default:l(()=>[t(W,{data:a.value,stripe:""},{default:l(()=>[t(c,{prop:"website_name",label:"网站",width:"150"}),t(c,{prop:"file_name",label:"文件名","min-width":"300","show-overflow-tooltip":""}),t(c,{prop:"total_records",label:"记录数",width:"100"}),t(c,{prop:"file_size",label:"文件大小",width:"120"}),t(c,{prop:"export_time",label:"导出时间",width:"180"}),t(c,{label:"操作",width:"120",fixed:"right"},{default:l(({row:r})=>[t(D,{type:"primary",size:"small",onClick:ne=>v(r.file_name)},{default:l(()=>e[14]||(e[14]=[f(" 下载 ",-1)])),_:2,__:[14]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):B("",!0)])}}}),ie=ee(oe,[["__scopeId","data-v-63162bab"]]);export{ie as default};
